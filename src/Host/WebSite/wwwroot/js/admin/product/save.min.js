var itemsTable,saveVM,itemVM;Dropzone.autoDiscover=!1;saveVM=new Vue({el:"#app",data:{isNew:!0,title:"New",product:{asin:null}},methods:{loadData:function(){var n=this;n.isNew=$.isNW(n.product.asin);n.title=n.isNew?"New":"Edit";n.isNew||$.get("/api/product/"+n.product.asin,function(t){t.imageUrl=$.isNW(t.imageUrl)?$.pic(null,100,100):$.pic(t.imageUrl);n.product=t})},save:function(){var n=this,t=n.isNew?"POST":"PUT";return $.ajax({url:"/api/product",type:t,data:{Product:n.product},success:function(t){$.isSuccess(t)?bootbox.alert("Save successfully.",function(){window.location="/admin/product/Save/"+n.product.asin}):bootbox.alert(t)}}),!1}},beforeMount:function(){var n=this,t=window.location.href,i=t.substring(t.lastIndexOf("/")+1);i!=="Save"&&(n.product.asin=i);n.loadData()}});itemVM=new Vue({el:"#itemModal",data:{isNew:!0,item:{sku:null,invQty:0}},methods:{loadData:function(){var n=this;n.isNew=$.isNW(n.item.sku);n.isNew||$.get("/api/product/item",{asin:saveVM.product.asin,sku:n.item.sku},function(t){n.item=t})},save:function(){var n=this,t=n.isNew?"POST":"PUT";return $.ajax({url:"/api/product/item",type:t,data:{ProductItem:n.item},success:function(n){$.isSuccess(n)?bootbox.alert("Save successfully.",function(){window.location="/admin/product/Save/"+saveVM.product.asin}):bootbox.alert(n)}}),!1},show:function(){bootbox.alert("aaa")}},beforeMount:function(){var n=this;n.item.asin=saveVM.product.asin}});$(function(){itemsTable=$("#itemsTable").DataTable({serverSide:!0,searchDelay:500,lengthMenu:[5,10,25],ajax:{url:"/api/product/items",data:{asin:saveVM.product.asin}},columns:[{data:"sku"},{data:"alias",orderable:!1},{data:"color",orderable:!1},{data:"size",orderable:!1},{data:"invQty",width:50,orderable:!1},{width:120,orderable:!1,render:function(n,t,i){return'<button class="editBtn btn btn-sm btn-primary mr-2" type="button" data-toggle="modal" data-target="#itemModal" data-id="'+i.sku+'">Edit<\/a><button class="delBtn btn btn-sm btn-danger" type="button" data-id="'+i.asin+'">Delete<\/button>'}}],columnDefs:[{className:"text-center",targets:[-1]}],order:[[1,"DESC"]]});$("#itemModal").on("click","#itemSaveBtn",function(){var n=$(this);itemVM.save()});$("#itemsTable").on("click",".editBtn",function(){var n=$(this),t=n.data("id");itemVM.item.sku=t;itemVM.loadData()});$("#itemsTable").on("click",".delBtn",function(){var n=$(this);bootbox.confirm("Delete product?",function(t){if(t){var i=n.data("id");$.ajax({url:"/api/product/item"+i,type:"DELETE",success:function(n){$.isSuccess(n)?window.location="/admin/product/item":bootbox.alert(n)}})}})});$("#mydropzone").dropzone({parallelUploads:1,maxFilesize:1,autoProcessQueue:!1,addRemoveLinks:!0,dictDefaultMessage:'<span class="text-center"><span class="font-lg visible-xs-block visible-sm-block visible-lg-block"><span class="font-lg">Drop files to upload<\/span> <span>&nbsp&nbsp<h4 class="display-inline"> (Or Click)<\/h4><\/span>',dictResponseError:"Error uploading file!",acceptedFiles:"image/*",init:function(){var n=this;$("#uploadBtn").on("click",function(t){t.preventDefault();t.stopPropagation();n.getQueuedFiles().length>0?n.processQueue():bootbox.alert("Please add files to upload.")});n.on("removedfile",function(){n.files.length<=0&&$("#uploadBtn").attr("disabled",!0)});n.on("addedfile",function(){n.files.length>0&&$("#uploadBtn").attr("disabled",!1);n.files[1]!==null&&n.removeFile(n.files[0])});n.on("sending",function(n,t,i){i.append("PostData[ASIN]",saveVM.product.asin)});n.on("success",function(t,i){i.isSuccess?saveVM.product.imageUrl=i.result.imageUrl:bootbox.alert(respones.msgCode);$("#uploadModal").modal("toggle");n.removeAllFiles()})}})});