var itemsTable;Dropzone.autoDiscover=!1;$(function(){var n=new Vue({el:"#app",data:{isNew:!0,title:"New",product:{asin:null}},methods:{loadData:function(){var n=this;n.isNew=$.isNW(n.product.asin);n.title=n.isNew?"New":"Edit";n.isNew||$.get("/api/product/"+n.product.asin,function(t){t.imageUrl=$.isNW(t.imageUrl)?$.pic(null,100,100):$.pic(t.imageUrl);n.product=t})},save:function(){var n=this,t=n.isNew?"POST":"PUT";return $.ajax({url:"/api/product",type:t,data:{Product:n.product},success:function(t){$.isSuccess(t)?bootbox.alert("Save successfully.",function(){window.location="/admin/product/Save/"+n.product.asin}):bootbox.alert(t)}}),!1}},beforeMount:function(){var n=this,t=window.location.href,i=t.substring(t.lastIndexOf("/")+1);i!="Save"&&(n.product.asin=i);n.loadData()}}),t=new Vue({el:"#itemsModal",data:{item:{sku:null}},methods:{loadData:function(){var t=this;$.isNW(t.item.sku)||$.get("/api/product/item",{asin:n.product.asin,sku:t.item.sku},function(n){t.item=n})},save:function(){}},beforeMount:function(){var t=this;t.item.asin=n.product.asin;t.loadData()}});itemsTable=$("#itemsTable").DataTable({serverSide:!0,searchDelay:500,lengthMenu:[5,10,25],ajax:{url:"/api/product/items",data:{asin:n.product.asin}},columns:[{data:"sku"},{data:"alias",orderable:!1},{data:"color",orderable:!1},{data:"size",orderable:!1},{data:"invQty",width:50,orderable:!1},{width:120,orderable:!1,render:function(n,t,i){return'<button class="btn btn-sm btn-primary mr-2" type="button" data-toggle="modal" data-target="#itemsModal">Edit<\/a><button class="delBtn btn btn-sm btn-danger" type="button" data-id="'+i.asin+'">Delete<\/button>'}}],columnDefs:[{className:"text-center",targets:[-1]},],order:[[1,"DESC"]]});$("#itemsTable").on("click",".delBtn",function(){var n=$(this);bootbox.confirm("Delete product?",function(t){if(t){var i=n.data("id");$.ajax({url:"/api/product/"+i,type:"DELETE",success:function(n){$.isSuccess(n)?window.location="/admin/product":bootbox.alert(n)}})}})});$("#mydropzone").dropzone({parallelUploads:1,maxFilesize:1,autoProcessQueue:!1,addRemoveLinks:!0,dictDefaultMessage:'<span class="text-center"><span class="font-lg visible-xs-block visible-sm-block visible-lg-block"><span class="font-lg">Drop files to upload<\/span> <span>&nbsp&nbsp<h4 class="display-inline"> (Or Click)<\/h4><\/span>',dictResponseError:"Error uploading file!",acceptedFiles:"image/*",init:function(){var t=this;$("#uploadBtn").on("click",function(n){n.preventDefault();n.stopPropagation();t.getQueuedFiles().length>0?t.processQueue():bootbox.alert("Please add files to upload.")});t.on("removedfile",function(){t.files.length<=0&&$("#uploadBtn").attr("disabled",!0)});t.on("addedfile",function(){t.files.length>0&&$("#uploadBtn").attr("disabled",!1);t.files[1]!=null&&t.removeFile(t.files[0])});t.on("sending",function(t,i,r){r.append("PostData[ASIN]",n.product.asin)});t.on("success",function(i,r){r.isSuccess?n.product.imageUrl=r.result.imageUrl:bootbox.alert(respones.msgCode);$("#uploadModal").modal("toggle");t.removeAllFiles()})}})});